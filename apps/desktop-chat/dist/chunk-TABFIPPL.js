import{a as je,b as Oe,c as X,d as Q,e as Z,f as ee,g as te,h as ne}from"./chunk-QKWSGPHI.js";import{C as F,F as We,I as H,f as Le,i as ge,j as q,k as $e,m as _e,p as Pe,q as Ge,r as Ue,s as qe,w as Y,y as Be,z as ze}from"./chunk-MLAOUUMU.js";import{j as He}from"./chunk-UAUK7NRM.js";import{$ as x,$a as p,A as ve,Ab as d,B as xe,Bb as M,Cb as k,E as $,G as ye,Gb as ke,Ha as Te,Hb as D,I as be,J as B,Ka as r,P as Ie,Qb as Fe,S as E,Ta as g,Va as we,W as z,Ya as u,Yb as Re,_a as T,_b as Ve,a as re,ab as j,ac as J,b as ae,bb as Me,da as y,db as N,ea as W,eb as Se,fb as O,gb as P,hb as G,ib as U,jb as a,kb as s,lb as _,mb as ce,na as f,nb as pe,oa as C,oc as Ne,pb as w,qb as h,qc as Ae,rb as l,rc as De,s as he,sb as me,sc as Qe,tb as de,tc as v,ub as Ee,va as le,vb as ue,wb as A,xb as b,ya as R,yb as I,z as se,za as V,zb as K}from"./chunk-5MFFBO5G.js";var et=["*"];function tt(t,c){if(t&1){let e=w();a(0,"img",6),h("error",function(i){f(e);let o=l(2);return C(o.imageError(i))}),s()}if(t&2){let e=l(2);p("src",e.image,Te)("alt",e.alt)}}function nt(t,c){if(t&1&&_(0,"span",8),t&2){let e=l(3);N(e.icon),p("ngClass","p-chip-icon"),T("data-pc-section","icon")}}function it(t,c){if(t&1&&u(0,nt,1,4,"span",7),t&2){let e=l(2);p("ngIf",e.icon)}}function ot(t,c){if(t&1&&(a(0,"div",9),d(1),s()),t&2){let e=l(2);T("data-pc-section","label"),r(),M(e.label)}}function rt(t,c){if(t&1){let e=w();a(0,"span",13),h("click",function(i){f(e);let o=l(4);return C(o.close(i))})("keydown",function(i){f(e);let o=l(4);return C(o.onKeydown(i))}),s()}if(t&2){let e=l(4);N(e.removeIcon),p("ngClass","pi-chip-remove-icon"),T("data-pc-section","removeicon")("aria-label",e.removeAriaLabel)}}function at(t,c){if(t&1){let e=w();a(0,"TimesCircleIcon",14),h("click",function(i){f(e);let o=l(4);return C(o.close(i))})("keydown",function(i){f(e);let o=l(4);return C(o.onKeydown(i))}),s()}if(t&2){let e=l(4);N("pi-chip-remove-icon"),T("data-pc-section","removeicon")("aria-label",e.removeAriaLabel)}}function st(t,c){if(t&1&&(ce(0),u(1,rt,1,5,"span",11)(2,at,1,4,"TimesCircleIcon",12),pe()),t&2){let e=l(3);r(),p("ngIf",e.removeIcon),r(),p("ngIf",!e.removeIcon)}}function lt(t,c){}function ct(t,c){t&1&&u(0,lt,0,0,"ng-template")}function pt(t,c){if(t&1){let e=w();a(0,"span",15),h("click",function(i){f(e);let o=l(3);return C(o.close(i))})("keydown",function(i){f(e);let o=l(3);return C(o.onKeydown(i))}),u(1,ct,1,0,null,16),s()}if(t&2){let e=l(3);T("data-pc-section","removeicon")("aria-label",e.removeAriaLabel),r(),p("ngTemplateOutlet",e.removeIconTemplate)}}function mt(t,c){if(t&1&&(ce(0),u(1,st,3,2,"ng-container",5)(2,pt,2,3,"span",10),pe()),t&2){let e=l(2);r(),p("ngIf",!e.removeIconTemplate),r(),p("ngIf",e.removeIconTemplate)}}function dt(t,c){if(t&1&&(a(0,"div",2),de(1),u(2,tt,1,2,"img",3)(3,it,1,1,"ng-template",null,0,Fe)(5,ot,2,2,"div",4)(6,mt,3,2,"ng-container",5),s()),t&2){let e=K(4),n=l();N(n.styleClass),p("ngClass",n.containerClass())("ngStyle",n.style),T("data-pc-name","chip")("aria-label",n.label)("data-pc-section","root"),r(2),p("ngIf",n.image)("ngIfElse",e),r(3),p("ngIf",n.label),r(),p("ngIf",n.removable)}}var Ke=(()=>{class t{label;icon;image;alt;style;styleClass;removable=!1;removeIcon;onRemove=new le;onImageError=new le;config=x(Le);visible=!0;removeIconTemplate;get removeAriaLabel(){return this.config.getTranslation($e.ARIA).removeLabel}templates;ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"removeicon":this.removeIconTemplate=e.template;break;default:this.removeIconTemplate=e.template;break}})}containerClass(){return{"p-chip p-component":!0,"p-chip-image":this.image!=null}}close(e){this.visible=!1,this.onRemove.emit(e)}onKeydown(e){(e.key==="Enter"||e.key==="Backspace")&&this.close(e)}imageError(e){this.onImageError.emit(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=y({type:t,selectors:[["p-chip"]],contentQueries:function(n,i,o){if(n&1&&ue(o,ge,4),n&2){let m;b(m=I())&&(i.templates=m)}},hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",alt:"alt",style:"style",styleClass:"styleClass",removable:[2,"removable","removable",Ve],removeIcon:"removeIcon"},outputs:{onRemove:"onRemove",onImageError:"onImageError"},features:[we],ngContentSelectors:et,decls:1,vars:1,consts:[["iconTemplate",""],[3,"ngClass","class","ngStyle",4,"ngIf"],[3,"ngClass","ngStyle"],[3,"src","alt","error",4,"ngIf","ngIfElse"],["class","p-chip-text",4,"ngIf"],[4,"ngIf"],[3,"error","src","alt"],[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],[1,"p-chip-text"],["tabindex","0","class","pi-chip-remove-icon","role","button",3,"click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"class","ngClass","click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"class","click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"click","keydown","ngClass"],["tabindex","0","role","button",3,"click","keydown"],["tabindex","0","role","button",1,"pi-chip-remove-icon",3,"click","keydown"],[4,"ngTemplateOutlet"]],template:function(n,i){n&1&&(me(),u(0,dt,7,11,"div",1)),n&2&&p("ngIf",i.visible)},dependencies:()=>[Ne,Ae,Qe,De,_e],styles:[`@layer primeng{.p-chip{display:inline-flex;align-items:center}.p-chip-text,.p-chip-icon.pi,.pi-chip-remove-icon.pi{line-height:1.5}.pi-chip-remove-icon{cursor:pointer}.p-chip img{border-radius:50%}}
`],encapsulation:2,changeDetection:0})}return t})(),oe=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=W({type:t});static \u0275inj=z({imports:[v,_e,q,q]})}return t})();var L=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=W({type:t});static \u0275inj=z({imports:[v,q]})}return t})();function Ct(t,c){if(t&1){let e=w();a(0,"p-chip",14),h("click",function(){let i=f(e),o=i.$implicit,m=i.$index,S=l();return C(S.onSelectMessageCategory(o,m))}),s()}if(t&2){let e,n=c.$implicit,i=c.$index,o=l();Me("selected",((e=o.selectedMessageCategory())==null?null:e.index)===i),Ee("label",n.label)}}function ht(t,c){t&1&&_(0,"p-inputIcon",9)}function vt(t,c){t&1&&_(0,"p-inputIcon",10)}function xt(t,c){if(t&1&&_(0,"p-avatar",16),t&2){let e=l().$implicit;p("image",e.thumbnailUrl)}}function yt(t,c){t&1&&_(0,"p-avatar",17)}function bt(t,c){if(t&1){let e=w();a(0,"section",15),h("click",function(){let i=f(e),o=i.$implicit,m=i.$index,S=l();return C(S.onSelectConversation(o,m))}),u(1,xt,1,1,"p-avatar",16)(2,yt,1,0,"p-avatar",17),a(3,"section",18)(4,"span",19),d(5),s(),a(6,"div",20)(7,"span",21),d(8),s(),a(9,"span",22),d(10),s()()()()}if(t&2){let e,n=c.$implicit,i=c.$index,o=l();Se("w-full flex column-gap-2 min-h-max hover:bg-gray-800 ",((e=o.selectedConversation())==null?null:e.index)===i?"bg-gray-800":"bg-gray-900"," py-2 px-2 border-round-md cursor-pointer  transition-duration-200"),r(),O(n.thumbnailUrl?1:2),r(4),M(n.lastMessage.senderName),r(3),M(n.lastMessage.content),r(2),M(n.lastMessage.timeSend)}}var Je=(()=>{class t{conversations=V();messageCategoies=V();searchConversationChanges=R();selectConversationChanges=R();selecteMessageCategoryChanges=R();searching=g(!1);searchControl=new F("");selectedConversation=g({value:null,index:0});selectedMessageCategory=g({value:null,index:0});ngOnInit(){this.registerValueChanges()}registerValueChanges(){this.searchControl.valueChanges.pipe($(200),B(),E(e=>{this.searching.set(!0),this.searchConversationChanges.emit(e)}),be(2e3),E(()=>this.searching.set(!1))).subscribe()}onSelectConversation(e,n){n!=this.selectedConversation()?.index&&(this.selectedConversation.set({value:e,index:n}),this.selectConversationChanges.emit(e))}onSelectMessageCategory(e,n){n!=this.selectedMessageCategory()?.index&&(this.selectedMessageCategory.set({value:e,index:n}),this.selecteMessageCategoryChanges.emit(e))}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=y({type:t,selectors:[["lib-conversation"]],inputs:{conversations:[1,"conversations"],messageCategoies:[1,"messageCategoies"]},outputs:{searchConversationChanges:"searchConversationChanges",selectConversationChanges:"selectConversationChanges",selecteMessageCategoryChanges:"selecteMessageCategoryChanges"},standalone:!0,features:[D],decls:17,vars:4,consts:[["titleSection",""],["categorySection",""],[1,"w-full","h-full"],[1,"message-title","pt-4","px-2"],[1,"text-2xl","pt-0"],[1,"w-full","mt-3","px-2"],["pRipple","",1,"mr-2","cursor-pointer","transition-duration-200","min-w-max",3,"label","selected"],[1,"w-full","my-2","px-2"],["iconPosition","right"],["styleClass","pi pi-spinner pi-spin"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Typing user or message...",1,"py-2","transition-duration-300","h-3rem","text-base","text-color","surface-ground","p-2","border-1","border-solid","surface-border","border-round","appearance-none","outline-none","focus:border-primary","w-full",3,"formControl"],[1,"flex","flex-column","gap-2","mt-2","overflow-y-auto","py-2","hidden-scrollbar"],[3,"class"],["pRipple","",1,"mr-2","cursor-pointer","transition-duration-200","min-w-max",3,"click","label"],[3,"click"],["size","large","shape","circle",3,"image"],["label","P","size","large","shape","circle"],[1,"w-full"],[1,"flex-1"],[1,"mt-2","flex","w-full"],[1,"flex-1","text-xs"],[1,"text-xs"]],template:function(n,i){n&1&&(a(0,"aside",2)(1,"section",3,0)(3,"span",4),d(4,"Messages (10)"),s()(),a(5,"section",5,1),G(7,Ct,1,3,"p-chip",6,P),s(),a(9,"section",7)(10,"p-iconField",8),u(11,ht,1,0,"p-inputIcon",9)(12,vt,1,0,"p-inputIcon",10),_(13,"input",11),s()(),a(14,"section",12),G(15,bt,11,7,"section",13,P),s()()),n&2&&(r(7),U(i.messageCategoies()),r(4),O(i.searching()?11:12),r(2),p("formControl",i.searchControl),r(),j("height","calc(100% - 150px)"),r(),U(i.conversations()))},dependencies:[oe,Ke,L,v,Q,X,ee,Z,ne,te,H,Be,ze,We]})}return t})();var It=["wrapperMessageContent"],Tt=["messageListRef"],wt=["chatControlRef"];function Mt(t,c){if(t&1&&(a(0,"section",18)(1,"div"),d(2),s(),a(3,"p",20),d(4),s()()),t&2){let e=l().$implicit;r(2),k(" ",e.content," "),r(2),k(" ",(e==null?null:e.timestamp)||"2 mins ago"," ")}}function St(t,c){if(t&1&&(a(0,"section",19)(1,"div"),d(2),s(),a(3,"p",20),d(4),s()()),t&2){let e=l().$implicit;r(2),k(" ",e.content," "),r(2),k(" ",(e==null?null:e.timestamp)||"2 mins ago"," ")}}function Et(t,c){if(t&1&&u(0,Mt,5,2,"section",18)(1,St,5,2,"section",19),t&2){let e=c.$implicit;O(e.isSender?0:1)}}var Xe=(()=>{class t{messages=V([]);sender=V();sendMessage=R();wrapperMessageContent;messageListRef;chatControlRef;originalMessageContentHeight=g(0);originalMessageActionHeight=g(60);chatControl=new F("");cd=x(Re);computedMessageContentHeight=J(()=>(console.log("Re computedMessageContentHeight"),`${this.originalMessageContentHeight()-this.originalMessageActionHeight()}px`));screenSize$=se(window,"resize").pipe(he(()=>({width:window.innerWidth,height:window.innerHeight})),$(50),Ie({width:window.innerWidth,height:window.innerHeight}));ngAfterViewInit(){this.registerValueChanges(),this.originalMessageContentHeight.set(this.wrapperMessageContent.nativeElement.offsetHeight),this.scrollToBottom()}registerValueChanges(){this.chatControl.valueChanges.pipe(E(e=>{console.log("chatControl: ",e)})).subscribe(),se(this.chatControlRef.nativeElement,"keyup").pipe($(150),xe(e=>e.keyCode===13),B(),E(e=>{console.log("Chatting: ",e),this.sendMessage.emit(e?.target?.value)})).subscribe(),this.screenSize$.pipe(E(()=>{this.originalMessageContentHeight.set(this.wrapperMessageContent.nativeElement.offsetHeight),this.cd.detectChanges(),this.scrollToBottom()})).subscribe()}scrollToBottom(){this.messageListRef&&ve(100).pipe(ye(1)).subscribe(()=>{console.log("this.messageListRef.nativeElement.scrollHeight: ",this.messageListRef.nativeElement.scrollHeight),this.messageListRef.nativeElement.scrollTo({top:this.messageListRef.nativeElement.scrollHeight,behavior:"smooth"})})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=y({type:t,selectors:[["lib-chatting"]],viewQuery:function(n,i){if(n&1&&(A(It,7),A(Tt,7),A(wt,7)),n&2){let o;b(o=I())&&(i.wrapperMessageContent=o.first),b(o=I())&&(i.messageListRef=o.first),b(o=I())&&(i.chatControlRef=o.first)}},inputs:{messages:[1,"messages"],sender:[1,"sender"]},outputs:{sendMessage:"sendMessage"},standalone:!0,features:[D],decls:22,vars:8,consts:[["wrapperMessageContent",""],["messageListRef",""],["chatControlRef",""],[1,"w-full","h-full"],[1,"pt-3","pb-1","border-bottom-1","border-blue-900","w-full","column-gap-3","flex","min-h-max","px-4","flex","align-items-center"],[1,"w-full","column-gap-3","flex"],["size","large","shape","circle",3,"image"],[1,"w-full","flex","flex-column"],[1,"mb-1"],[1,"text-xs","text-color"],[1,"ml-auto","h-full","flex","align-items-center"],["tooltipPosition","right",1,"pi","pi-info-circle","text-2xl","text-color","cursor-pointer",3,"pTooltip"],[1,"w-full","relative",2,"height","calc(100% - 73px)"],[1,"overflow-y-auto","mt-2","px-2"],[1,"fixed","bottom-0"],["iconPosition","right",1,"w-full"],["styleClass","pi pi-send","tooltipPosition","right"],["type","text","pInputText","","placeholder","Typing message...",1,"py-2","transition-duration-300","h-3rem","text-base","text-color","surface-ground","p-2","border-1","border-solid","surface-border","border-round","appearance-none","outline-none","focus:border-primary","w-full"],[1,"ml-auto","mb-4","col-6","column-gap-2","min-h-max","bg-blue-700","py-2","px-2","border-round-bottom-2xl","border-round-left-2xl","cursor-pointer","transition-duration-200"],[1,"mr-auto","mb-4","col-6","column-gap-2","min-h-max","bg-gray-800","py-2","px-2","border-round-bottom-2xl","border-round-right-2xl","cursor-pointer","transition-duration-200"],[1,"text-xs","p-0","mx-0","mb-0","mt-2"]],template:function(n,i){if(n&1&&(a(0,"section",3)(1,"section",4)(2,"section",5),_(3,"p-avatar",6),a(4,"section",7)(5,"span",8),d(6),s(),a(7,"div",9),d(8),s()()(),a(9,"section",10),_(10,"i",11),s()(),a(11,"section",12,0)(13,"section",13,1),G(15,Et,2,1,null,null,P),s(),a(17,"section",14)(18,"p-iconField",15),_(19,"p-inputIcon",16)(20,"input",17,2),s()()()()),n&2){let o,m,S,Ze=K(12);r(3),p("image",(o=i.sender())==null?null:o.thumbnailUrl),r(3),M((m=i.sender())==null||m.lastMessage==null?null:m.lastMessage.senderName),r(2),k(" ",(S=i.sender())==null||S.lastMessage==null?null:S.lastMessage.timeSend," "),r(2),p("pTooltip","View infor"),r(3),j("height",i.computedMessageContentHeight()),r(2),U(i.messages()),r(2),j("width",Ze.offsetWidth+"px")}},dependencies:[L,v,Q,X,Oe,je,ee,Z,ne,te,H]})}return t})();var fe=function(t){return t.Idle="IDLE",t.Sending="SENDING",t.SendingSuccess="SENDING_SUCCESS",t.SendingFail="SENDING_FAIL",t.NewMessage="NEW_MESSAGE_INCOMMING",t}(fe||{});var Ye={messages:[],members:[],conversationId:null,status:fe.Idle};var Ce=Pe(qe(Ye),Ue((t,c=x(Y))=>({sendMessage:e=>{},disconnectSocket(){console.log("disconnectSocket...")},registerInCommingMessage(){console.log("registerInCommingMessage... ")}})),Ge({onDestroy(t){},onInit(t){console.log("socketService:")}}));var kt=["inputRef"],Bn=(()=>{class t{title="Chat with me";chatInputControl=new F("");userControl=new F(null);appState=x(Y);conversation=g(null);chatStore=x(Ce);messages=this.chatStore.messages;conversations=J(()=>this.appState.user().profile?.friends?.map(e=>ae(re({},e),{sender:e.fullName,lastMessage:"...",unread:!0,time:"2 mins ago",avatarUrl:e.avatarUrl,profileId:e.id})));messageCategories=g([{label:"All",selected:!0},{label:"Unread",selected:!1},{label:"Groups",selected:!1}]);user=this.appState.user;senderAvatar=g("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTynVaVrlGzFHaL33Qx5QVLGdNiT1bB2IgS-g&s");recieverAvatar=g("https://t3.ftcdn.net/jpg/05/76/94/70/360_F_576947051_DFT5rJEsF8yturr1DOlB3rxhtxswGSmP.jpg");inputRef;onSend(e){this.chatInputControl.setValue(e?.target?.value),this.inputRef.nativeElement.value=""}onEnterName(e){this.userControl.setValue(e?.target?.value)}calcHeight(e,n){return`calc(100% - (${e-n}px))`}onMessageCategoryChanges(e){console.log("onMessageCategoryChanges",e)}onConversationCategoryChanges(e){console.log("onConversationCategoryChanges",e),this.conversation.set(e)}onSendMessage(e){console.log("onSendMessage: ",e),this.chatStore.sendMessage({senderId:this.appState.user().profile?.id,receiverId:this.conversation()?.members[0].id,message:e})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=y({type:t,selectors:[["lib-chat-feature"]],viewQuery:function(n,i){if(n&1&&A(kt,5),n&2){let o;b(o=I())&&(i.inputRef=o.first)}},standalone:!0,features:[ke([Ce]),D],decls:3,vars:4,consts:[[1,"w-full","h-full","grid","overflow-hidden","p-0","m-0"],[1,"hidden","md:block","md:col-4","border-right-1","border-blue-900","h-full",3,"selecteMessageCategoryChanges","selectConversationChanges","messageCategoies","conversations"],[1,"col-12","md:col-8","p-0","h-full",3,"sendMessage","sender","messages"]],template:function(n,i){n&1&&(a(0,"section",0)(1,"lib-conversation",1),h("selecteMessageCategoryChanges",function(m){return i.onMessageCategoryChanges(m)})("selectConversationChanges",function(m){return i.onConversationCategoryChanges(m)}),s(),a(2,"lib-chatting",2),h("sendMessage",function(m){return i.onSendMessage(m)}),s()()),n&2&&(r(),p("messageCategoies",i.messageCategories())("conversations",i.conversations()),r(),p("sender",i.conversation())("messages",i.messages()))},dependencies:[oe,L,v,He,Q,Xe,H,Je]})}return t})();export{Bn as ChatFeatureComponent};
