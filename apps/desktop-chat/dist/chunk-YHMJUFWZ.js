import{a as Ae,b as Se,c as Fe,d as ie,e as He,f as je,g as Be,h as Ge}from"./chunk-CJB5P4B6.js";import{$ as Ut,A as jt,B as ot,C as x,E as Bt,F as Gt,G as K,H as Z,I as Re,J as De,K as Oe,L as Ne,N as Ke,O as Qt,Q as $e,S as ne,U as zt,V as Zt,Y as Qe,c as tt,ca as oe,d as it,f as ye,h as Te,p as w,q as Kt,r as nt,t as $t,u as Pe,x as we,y as z,z as Ht}from"./chunk-O2HTMIZG.js";import{a as Dt,g as Ot,h as Nt,k as be}from"./chunk-4J4APNOW.js";import{$ as y,$a as h,A as gt,Aa as Ee,Ab as N,B as ht,Bb as C,Cb as R,Db as $,E as ae,Ea as wt,G as ft,Ha as qe,Hb as Vt,I as It,Ia as Le,Ib as Q,J as Me,Jb as ge,Kb as Je,La as c,Lb as Pt,Ma as v,P as Ct,Pb as he,Qa as We,Qb as fe,Ra as St,S as E,Sb as Ie,U as xt,Ua as T,V as vt,Va as Mt,W as X,Wa as le,Za as u,_b as W,a as D,ab as r,ac as H,b as O,bb as ce,bc as te,cb as Et,cc as At,da as S,ea as Y,eb as F,ec as Ft,fb as Lt,ga as bt,gb as me,hb as pe,ib as de,jb as ue,jc as et,kb as m,lb as p,mb as f,na as _,nb as j,oa as g,ob as B,pa as yt,qa as Tt,qb as M,qc as Ce,rb as b,rc as Rt,s as _t,sb as s,sc as xe,tb as Xe,tc as ve,ub as Ye,uc as ke,va as A,vb as kt,vc as V,wb as _e,xb as G,xc as Ve,ya as J,yb as L,z as Ue,za as ee,zb as k}from"./chunk-YZQP7WSJ.js";var st=function(i){return i.Idle="IDLE",i.Sending="SENDING",i.SendingSuccess="SENDING_SUCCESS",i.SendingFail="SENDING_FAIL",i.NewMessage="NEW_MESSAGE_INCOMMING",i}(st||{}),rt=function(i){return i.Idle="IDLE",i.NewConversationComming="NEW_CONVERSATION_COMMING",i}(rt||{});var at={conversations:[],status:rt.Idle};var qt=(()=>{class i{http=y(Dt);appConfig=Qt();baseUrl="";constructor(){this.baseUrl=this.appConfig.apiUrl+"/"}getConversations(e={limit:10,profileId:-1}){return this.http.post(`${this.baseUrl}conversation/search`,e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=vt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var lt=Re(Ne(at),Oe((i,l=y(qt),e=y(ne),t=$e())=>({resotreMessageToConversation(n,o){let a=Z(i).conversations,d=o.filter(I=>!I.isOld);a.length==0?a.push({id:n,messages:o}):a.forEach(I=>{I.id===n&&(d.forEach(P=>P.isOld=!0),I.messages?I.messages=[...I.messages,...d]:I.messages=[])}),K(i,{conversations:a})},getConversationMessages(n){return Z(i).conversations.find(o=>o.id==n)?.messages},reset(){K(i,at)},getConversations(){l.getConversations({profileId:e.user()?.profile?.id,limit:10}).pipe(E(n=>{console.log("conversations: ",n.data),K(i,{conversations:n.data?.filter?.(o=>o.lastMessage.id!==e.user()?.profile?.id)})})).subscribe()},joinRoom(n,o){console.log("joinRoom: ",n,o),t.joinRoom(n,o)},leaveRoom(n,o){console.log("leaveRoom: ",n,o),t.leaveRoom(n,o)},registerNewMessageConversation(){t.listen(Ke.NEW_LAST_MESSAGE).pipe(E(n=>{let o=Z(i).conversations;o.forEach(a=>{a.id===n?.conversationId&&(a.lastMessage=O(D({},a.lastMessage),{isSender:e.user()?.profile?.id==n.senderId,content:n.content,timeSend:n.timeSend}))}),o.sort((a,d)=>new Date(a?.lastMessage?.timeSend).getTime()-new Date(d?.lastMessage?.timeSend).getTime()),K(i,{conversations:o}),console.log("NEW_LAST_MESSAGE: ",n),console.log("new conversations: ",o)})).subscribe()}})),De({onInit(i){i.getConversations(),i.registerNewMessageConversation()},onDestroy(i){i.reset()}}));var ii=["*"];function ni(i,l){if(i&1){let e=M();m(0,"img",6),b("error",function(n){_(e);let o=s(2);return g(o.imageError(n))}),p()}if(i&2){let e=s(2);r("src",e.image,Le)("alt",e.alt)}}function oi(i,l){if(i&1&&f(0,"span",8),i&2){let e=s(3);F(e.icon),r("ngClass","p-chip-icon"),h("data-pc-section","icon")}}function si(i,l){if(i&1&&u(0,oi,1,4,"span",7),i&2){let e=s(2);r("ngIf",e.icon)}}function ri(i,l){if(i&1&&(m(0,"div",9),C(1),p()),i&2){let e=s(2);h("data-pc-section","label"),c(),R(e.label)}}function ai(i,l){if(i&1){let e=M();m(0,"span",13),b("click",function(n){_(e);let o=s(4);return g(o.close(n))})("keydown",function(n){_(e);let o=s(4);return g(o.onKeydown(n))}),p()}if(i&2){let e=s(4);F(e.removeIcon),r("ngClass","pi-chip-remove-icon"),h("data-pc-section","removeicon")("aria-label",e.removeAriaLabel)}}function li(i,l){if(i&1){let e=M();m(0,"TimesCircleIcon",14),b("click",function(n){_(e);let o=s(4);return g(o.close(n))})("keydown",function(n){_(e);let o=s(4);return g(o.onKeydown(n))}),p()}if(i&2){let e=s(4);F("pi-chip-remove-icon"),h("data-pc-section","removeicon")("aria-label",e.removeAriaLabel)}}function ci(i,l){if(i&1&&(j(0),u(1,ai,1,5,"span",11)(2,li,1,4,"TimesCircleIcon",12),B()),i&2){let e=s(3);c(),r("ngIf",e.removeIcon),c(),r("ngIf",!e.removeIcon)}}function mi(i,l){}function pi(i,l){i&1&&u(0,mi,0,0,"ng-template")}function di(i,l){if(i&1){let e=M();m(0,"span",15),b("click",function(n){_(e);let o=s(3);return g(o.close(n))})("keydown",function(n){_(e);let o=s(3);return g(o.onKeydown(n))}),u(1,pi,1,0,null,16),p()}if(i&2){let e=s(3);h("data-pc-section","removeicon")("aria-label",e.removeAriaLabel),c(),r("ngTemplateOutlet",e.removeIconTemplate)}}function ui(i,l){if(i&1&&(j(0),u(1,ci,3,2,"ng-container",5)(2,di,2,3,"span",10),B()),i&2){let e=s(2);c(),r("ngIf",!e.removeIconTemplate),c(),r("ngIf",e.removeIconTemplate)}}function _i(i,l){if(i&1&&(m(0,"div",2),Ye(1),u(2,ni,1,2,"img",3)(3,si,1,1,"ng-template",null,0,Ie)(5,ri,2,2,"div",4)(6,ui,3,2,"ng-container",5),p()),i&2){let e=N(4),t=s();F(t.styleClass),r("ngClass",t.containerClass())("ngStyle",t.style),h("data-pc-name","chip")("aria-label",t.label)("data-pc-section","root"),c(2),r("ngIf",t.image)("ngIfElse",e),c(3),r("ngIf",t.label),c(),r("ngIf",t.removable)}}var Wt=(()=>{class i{label;icon;image;alt;style;styleClass;removable=!1;removeIcon;onRemove=new A;onImageError=new A;config=y(Pe);visible=!0;removeIconTemplate;get removeAriaLabel(){return this.config.getTranslation(Ht.ARIA).removeLabel}templates;ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"removeicon":this.removeIconTemplate=e.template;break;default:this.removeIconTemplate=e.template;break}})}containerClass(){return{"p-chip p-component":!0,"p-chip-image":this.image!=null}}close(e){this.visible=!1,this.onRemove.emit(e)}onKeydown(e){(e.key==="Enter"||e.key==="Backspace")&&this.close(e)}imageError(e){this.onImageError.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["p-chip"]],contentQueries:function(t,n,o){if(t&1&&_e(o,we,4),t&2){let a;L(a=k())&&(n.templates=a)}},hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",alt:"alt",style:"style",styleClass:"styleClass",removable:[2,"removable","removable",H],removeIcon:"removeIcon"},outputs:{onRemove:"onRemove",onImageError:"onImageError"},features:[le],ngContentSelectors:ii,decls:1,vars:1,consts:[["iconTemplate",""],[3,"ngClass","class","ngStyle",4,"ngIf"],[3,"ngClass","ngStyle"],[3,"src","alt","error",4,"ngIf","ngIfElse"],["class","p-chip-text",4,"ngIf"],[4,"ngIf"],[3,"error","src","alt"],[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],[1,"p-chip-text"],["tabindex","0","class","pi-chip-remove-icon","role","button",3,"click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"class","ngClass","click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"class","click","keydown",4,"ngIf"],["tabindex","0","role","button",3,"click","keydown","ngClass"],["tabindex","0","role","button",3,"click","keydown"],["tabindex","0","role","button",1,"pi-chip-remove-icon",3,"click","keydown"],[4,"ngTemplateOutlet"]],template:function(t,n){t&1&&(Xe(),u(0,_i,7,11,"div",1)),t&2&&r("ngIf",n.visible)},dependencies:()=>[Ce,xe,ke,ve,ot],styles:[`@layer primeng{.p-chip{display:inline-flex;align-items:center}.p-chip-text,.p-chip-icon.pi,.pi-chip-remove-icon.pi{line-height:1.5}.pi-chip-remove-icon{cursor:pointer}.p-chip img{border-radius:50%}}
`],encapsulation:2,changeDetection:0})}return i})(),ze=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=Y({type:i});static \u0275inj=X({imports:[V,ot,z,z]})}return i})();var se=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=Y({type:i});static \u0275inj=X({imports:[V,z]})}return i})();var Ze=(()=>{class i{cdr;currentValue;timer;defaultIntervelTime=3e4;constructor(e){this.cdr=e}transform(e,t){if(!e)return"";let n=new Date(e);return this.currentValue=this.calculateTimeAgo(n),this.clearTimer(),this.timer=setInterval(()=>{this.currentValue=this.calculateTimeAgo(n),this.cdr.markForCheck()},t||this.defaultIntervelTime),this.currentValue}calculateTimeAgo(e){let n=new Date().getTime()-e.getTime(),o=Math.floor(n/1e3),a=Math.floor(o/60),d=Math.floor(a/60),I=Math.floor(d/24),P=Math.floor(I/7);return a<1?"Just now":a<60?`${a} ${a==1?"min":"mins"} ago`:d<24?`${d} ${d==1?"hour":"hours"} ago`:I<7?`${I} day${I>1?"s":""} ago`:this.formatDate(e)}formatDate(e){let t={hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"};return e.toLocaleDateString("en-GB",t).replace(",","")}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}ngOnDestroy(){this.clearTimer()}static \u0275fac=function(t){return new(t||i)(v(W,16))};static \u0275pipe=bt({name:"timeAgo",type:i,pure:!1,standalone:!0})}return i})();function Ci(i,l){if(i&1){let e=M();m(0,"p-chip",14),b("click",function(){let n=_(e),o=n.$implicit,a=n.$index,d=s();return g(d.onSelectMessageCategory(o,a))}),p()}if(i&2){let e,t=l.$implicit,n=l.$index,o=s();Et("selected",((e=o.selectedMessageCategory())==null?null:e.index)===n),kt("label",t.label)}}function xi(i,l){i&1&&f(0,"p-inputIcon",9)}function vi(i,l){i&1&&f(0,"p-inputIcon",10)}function bi(i,l){if(i&1&&f(0,"p-avatar",16),i&2){let e=s().$implicit;r("image",e.receiver.avatarUrl)}}function yi(i,l){i&1&&f(0,"p-avatar",17)}function Ti(i,l){if(i&1){let e=M();m(0,"section",15),b("click",function(){let n=_(e),o=n.$implicit,a=n.$index,d=s();return g(d.onSelectConversation(o,a))}),u(1,bi,1,1,"p-avatar",16)(2,yi,1,0,"p-avatar",17),m(3,"section",18)(4,"span",19),C(5),p(),m(6,"div",20)(7,"span",21),C(8),p(),m(9,"span",22),C(10),he(11,"timeAgo"),p()()()()}if(i&2){let e,t=l.$implicit,n=l.$index,o=s();Lt("w-full flex column-gap-2 min-h-max hover:bg-gray-800 ",((e=o.selectedConversation())==null?null:e.index)===n?"bg-gray-800":"bg-gray-900"," py-2 px-2 border-round-md cursor-pointer  transition-duration-200"),c(),me(t.receiver.avatarUrl?1:2),c(4),R(t.receiver.fullName),c(3),R(t.lastMessage.content),c(2),R(fe(11,7,t.lastMessage.timeSend))}}var Xt=(()=>{class i{conversations=ee();messageCategoies=ee();searchConversationChanges=J();selectConversationChanges=J();selecteMessageCategoryChanges=J();searching=T(!1);searchControl=new Qe("");selectedConversation=T({value:null,index:-1});selectedMessageCategory=T({value:null,index:-1});ngOnInit(){this.registerValueChanges()}registerValueChanges(){this.searchControl.valueChanges.pipe(ae(200),Me(),E(e=>{this.searching.set(!0),this.searchConversationChanges.emit(e)}),It(2e3),E(()=>this.searching.set(!1))).subscribe()}onSelectConversation(e,t){t!=this.selectedConversation()?.index&&(this.selectedConversation.set({value:e,index:t}),this.selectConversationChanges.emit(e))}onSelectMessageCategory(e,t){t!=this.selectedMessageCategory()?.index&&(this.selectedMessageCategory.set({value:e,index:t}),this.selecteMessageCategoryChanges.emit(e))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["lib-conversation"]],inputs:{conversations:[1,"conversations"],messageCategoies:[1,"messageCategoies"]},outputs:{searchConversationChanges:"searchConversationChanges",selectConversationChanges:"selectConversationChanges",selecteMessageCategoryChanges:"selecteMessageCategoryChanges"},standalone:!0,features:[Q],decls:17,vars:4,consts:[["titleSection",""],["categorySection",""],[1,"w-full","h-full"],[1,"message-title","pt-4","px-2"],[1,"text-2xl","pt-0"],[1,"w-full","mt-3","px-2"],["pRipple","",1,"mr-2","cursor-pointer","transition-duration-200","min-w-max",3,"label","selected"],[1,"w-full","my-2","px-2"],["iconPosition","right"],["styleClass","pi pi-spinner pi-spin"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Typing user or message...",1,"py-2","transition-duration-300","h-3rem","text-base","text-color","surface-ground","p-2","border-1","border-solid","surface-border","border-round","appearance-none","outline-none","focus:border-primary","w-full",3,"formControl"],[1,"flex","flex-column","gap-2","mt-2","overflow-y-auto","py-2","hidden-scrollbar"],[3,"class"],["pRipple","",1,"mr-2","cursor-pointer","transition-duration-200","min-w-max",3,"click","label"],[3,"click"],["size","large","shape","circle",3,"image"],["label","P","size","large","shape","circle"],[1,"w-full"],[1,"flex-1"],[1,"mt-2","flex","w-full"],[1,"flex-1","text-xs"],[1,"text-xs"]],template:function(t,n){t&1&&(m(0,"aside",2)(1,"section",3,0)(3,"span",4),C(4,"Messages (10)"),p()(),m(5,"section",5,1),de(7,Ci,1,3,"p-chip",6,pe),p(),m(9,"section",7)(10,"p-iconField",8),u(11,xi,1,0,"p-inputIcon",9)(12,vi,1,0,"p-inputIcon",10),f(13,"input",11),p()(),m(14,"section",12),de(15,Ti,12,9,"section",13,pe),p()()),t&2&&(c(7),ue(n.messageCategoies()),c(4),me(n.searching()?11:12),c(2),r("formControl",n.searchControl),c(),ce("height","calc(100% - 150px)"),c(),ue(n.conversations()))},dependencies:[ze,Wt,se,Ze,V,ie,Fe,je,He,Ge,Be,oe,zt,Zt,Ut]})}return i})();var ct=(()=>{class i extends jt{static \u0275fac=(()=>{let e;return function(n){return(e||(e=Tt(i)))(n||i)}})();static \u0275cmp=S({type:i,selectors:[["AngleRightIcon"]],standalone:!0,features:[Mt,Q],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M5.25 11.1728C5.14929 11.1694 5.05033 11.1455 4.9592 11.1025C4.86806 11.0595 4.78666 10.9984 4.72 10.9228C4.57955 10.7822 4.50066 10.5916 4.50066 10.3928C4.50066 10.1941 4.57955 10.0035 4.72 9.86283L7.72 6.86283L4.72 3.86283C4.66067 3.71882 4.64765 3.55991 4.68275 3.40816C4.71785 3.25642 4.79932 3.11936 4.91585 3.01602C5.03238 2.91268 5.17819 2.84819 5.33305 2.83149C5.4879 2.81479 5.64411 2.84671 5.78 2.92283L9.28 6.42283C9.42045 6.56346 9.49934 6.75408 9.49934 6.95283C9.49934 7.15158 9.42045 7.34221 9.28 7.48283L5.78 10.9228C5.71333 10.9984 5.63193 11.0595 5.5408 11.1025C5.44966 11.1455 5.35071 11.1694 5.25 11.1728Z","fill","currentColor"]],template:function(t,n){t&1&&(yt(),m(0,"svg",0),f(1,"path",1),p()),t&2&&(F(n.getClassNames()),h("aria-label",n.ariaLabel)("aria-hidden",n.ariaHidden)("role",n.role))},encapsulation:2})}return i})();var Si=["sublist"],Mi=(i,l)=>({"p-submenu-list":i,"p-contextmenu-root-list":l}),Ei=()=>({"p-menuitem-link":!0}),Li=()=>({exact:!1}),ki=i=>({"p-menuitem-link":!0,"p-disabled":i}),Vi=i=>({$implicit:i});function Pi(i,l){if(i&1&&f(0,"li",8),i&2){let e=s().$implicit,t=s(2);r("ngStyle",t.getItemProp(e,"style"))("ngClass",t.getSeparatorItemClass(e)),h("id",t.getItemId(e))("data-pc-section","separator")}}function Ai(i,l){if(i&1&&f(0,"span",19),i&2){let e=s(4).$implicit,t=s(2);r("ngClass",t.getItemProp(e,"icon"))("ngStyle",t.getItemProp(e,"iconStyle")),h("data-pc-section","icon")("tabindex",-1)}}function Fi(i,l){if(i&1&&(m(0,"span",20),C(1),p()),i&2){let e=s(4).$implicit,t=s(2);h("data-pc-section","label"),c(),$(" ",t.getItemLabel(e)," ")}}function Ri(i,l){if(i&1&&f(0,"span",21),i&2){let e=s(4).$implicit,t=s(2);r("innerHTML",t.getItemLabel(e),qe),h("data-pc-section","label")}}function Di(i,l){if(i&1&&(m(0,"span",22),C(1),p()),i&2){let e=s(4).$implicit,t=s(2);r("ngClass",t.getItemProp(e,"badgeStyleClass")),c(),R(t.getItemProp(e,"badge"))}}function Oi(i,l){i&1&&f(0,"AngleRightIcon",25),i&2&&(r("styleClass","p-submenu-icon"),h("data-pc-section","submenuicon"))}function Ni(i,l){}function Ki(i,l){i&1&&u(0,Ni,0,0,"ng-template",26),i&2&&r("data-pc-section","submenuicon")}function $i(i,l){if(i&1&&(j(0),u(1,Oi,1,2,"AngleRightIcon",23)(2,Ki,1,1,null,24),B()),i&2){let e=s(6);c(),r("ngIf",!e.contextMenu.submenuIconTemplate),c(),r("ngTemplateOutlet",e.contextMenu.submenuIconTemplate)}}function Hi(i,l){if(i&1&&(m(0,"a",15),u(1,Ai,1,4,"span",16)(2,Fi,2,2,"span",17)(3,Ri,1,2,"ng-template",null,2,Ie)(5,Di,2,2,"span",18)(6,$i,3,2,"ng-container",11),p()),i&2){let e=N(4),t=s(3).$implicit,n=s(2);r("target",n.getItemProp(t,"target"))("ngClass",ge(11,Ei)),h("href",n.getItemProp(t,"url"),Le)("data-automationid",n.getItemProp(t,"automationId"))("data-pc-section","action")("tabindex",-1),c(),r("ngIf",n.getItemProp(t,"icon")),c(),r("ngIf",n.getItemProp(t,"escape"))("ngIfElse",e),c(3),r("ngIf",n.getItemProp(t,"badge")),c(),r("ngIf",n.isItemGroup(t))}}function ji(i,l){if(i&1&&f(0,"span",19),i&2){let e=s(4).$implicit,t=s(2);r("ngClass",t.getItemProp(e,"icon"))("ngStyle",t.getItemProp(e,"iconStyle")),h("data-pc-section","icon")("tabindex",-1)}}function Bi(i,l){if(i&1&&(m(0,"span",20),C(1),p()),i&2){let e=s(4).$implicit,t=s(2);h("data-pc-section","label"),c(),$(" ",t.getItemLabel(e)," ")}}function Gi(i,l){if(i&1&&f(0,"span",21),i&2){let e=s(4).$implicit,t=s(2);r("innerHTML",t.getItemLabel(e),qe),h("data-pc-section","label")}}function Qi(i,l){if(i&1&&(m(0,"span",22),C(1),p()),i&2){let e=s(4).$implicit,t=s(2);r("ngClass",t.getItemProp(e,"badgeStyleClass")),c(),R(t.getItemProp(e,"badge"))}}function zi(i,l){i&1&&f(0,"AngleRightIcon",25),i&2&&(r("styleClass","p-submenu-icon"),h("data-pc-section","submenuicon"))}function Zi(i,l){}function Ui(i,l){i&1&&u(0,Zi,0,0,"ng-template",26),i&2&&r("data-pc-section","submenuicon")}function qi(i,l){if(i&1&&(j(0),u(1,zi,1,2,"AngleRightIcon",23)(2,Ui,1,1,null,24),B()),i&2){let e=s(6);c(),r("ngIf",!e.contextMenu.submenuIconTemplate),c(),r("ngTemplateOutlet",e.contextMenu.submenuIconTemplate)}}function Wi(i,l){if(i&1&&(m(0,"a",27),u(1,ji,1,4,"span",16)(2,Bi,2,2,"span",17)(3,Gi,1,2,"ng-template",null,2,Ie)(5,Qi,2,2,"span",18)(6,qi,3,2,"ng-container",11),p()),i&2){let e=N(4),t=s(3).$implicit,n=s(2);r("routerLink",n.getItemProp(t,"routerLink"))("queryParams",n.getItemProp(t,"queryParams"))("routerLinkActive","p-menuitem-link-active")("routerLinkActiveOptions",n.getItemProp(t,"routerLinkActiveOptions")||ge(20,Li))("target",n.getItemProp(t,"target"))("ngClass",Je(21,ki,n.getItemProp(t,"disabled")))("fragment",n.getItemProp(t,"fragment"))("queryParamsHandling",n.getItemProp(t,"queryParamsHandling"))("preserveFragment",n.getItemProp(t,"preserveFragment"))("skipLocationChange",n.getItemProp(t,"skipLocationChange"))("replaceUrl",n.getItemProp(t,"replaceUrl"))("state",n.getItemProp(t,"state")),h("data-automationid",n.getItemProp(t,"automationId"))("tabindex",-1)("data-pc-section","action"),c(),r("ngIf",n.getItemProp(t,"icon")),c(),r("ngIf",n.getItemProp(t,"escape"))("ngIfElse",e),c(3),r("ngIf",n.getItemProp(t,"badge")),c(),r("ngIf",n.isItemGroup(t))}}function Xi(i,l){if(i&1&&(j(0),u(1,Hi,7,12,"a",13)(2,Wi,7,23,"a",14),B()),i&2){let e=s(2).$implicit,t=s(2);c(),r("ngIf",!t.getItemProp(e,"routerLink")),c(),r("ngIf",t.getItemProp(e,"routerLink"))}}function Yi(i,l){}function Ji(i,l){i&1&&u(0,Yi,0,0,"ng-template")}function en(i,l){if(i&1&&(j(0),u(1,Ji,1,0,null,28),B()),i&2){let e=s(2).$implicit,t=s(2);c(),r("ngTemplateOutlet",t.itemTemplate)("ngTemplateOutletContext",Je(2,Vi,e.item))}}function tn(i,l){if(i&1){let e=M();m(0,"p-contextMenuSub",29),b("itemClick",function(n){_(e);let o=s(4);return g(o.itemClick.emit(n))})("itemMouseEnter",function(n){_(e);let o=s(4);return g(o.onItemMouseEnter(n))}),p()}if(i&2){let e=s(2).$implicit,t=s(2);r("items",e.items)("itemTemplate",t.itemTemplate)("menuId",t.menuId)("visible",t.isItemActive(e)&&t.isItemGroup(e))("activeItemPath",t.activeItemPath)("focusedItemId",t.focusedItemId)("level",t.level+1)}}function nn(i,l){if(i&1){let e=M();m(0,"li",9,1)(2,"div",10),b("click",function(n){_(e);let o=s().$implicit,a=s(2);return g(a.onItemClick(n,o))})("mouseenter",function(n){_(e);let o=s().$implicit,a=s(2);return g(a.onItemMouseEnter({$event:n,processedItem:o}))}),u(3,Xi,3,2,"ng-container",11)(4,en,2,4,"ng-container",11),p(),u(5,tn,1,7,"p-contextMenuSub",12),p()}if(i&2){let e=s(),t=e.$implicit,n=e.index,o=s(2);F(o.getItemProp(t,"styleClass")),r("ngStyle",o.getItemProp(t,"style"))("ngClass",o.getItemClass(t))("tooltipOptions",o.getItemProp(t,"tooltipOptions")),h("id",o.getItemId(t))("data-pc-section","menuitem")("data-p-highlight",o.isItemActive(t))("data-p-focused",o.isItemFocused(t))("data-p-disabled",o.isItemDisabled(t))("aria-label",o.getItemLabel(t))("aria-disabled",o.isItemDisabled(t)||void 0)("aria-haspopup",o.isItemGroup(t)&&!o.getItemProp(t,"to")?"menu":void 0)("aria-expanded",o.isItemGroup(t)?o.isItemActive(t):void 0)("aria-level",o.level+1)("aria-setsize",o.getAriaSetSize())("aria-posinset",o.getAriaPosInset(n)),c(2),h("data-pc-section","content"),c(),r("ngIf",!o.itemTemplate),c(),r("ngIf",o.itemTemplate),c(),r("ngIf",o.isItemVisible(t)&&o.isItemGroup(t))}}function on(i,l){if(i&1&&u(0,Pi,1,4,"li",6)(1,nn,6,21,"li",7),i&2){let e=l.$implicit,t=s(2);r("ngIf",t.isItemVisible(e)&&t.getItemProp(e,"separator")),c(),r("ngIf",t.isItemVisible(e)&&!t.getItemProp(e,"separator"))}}function sn(i,l){if(i&1){let e=M();m(0,"ul",4,0),b("@overlayAnimation.start",function(n){_(e);let o=N(1),a=s();return g(a.onEnter(n,o))})("keydown",function(n){_(e);let o=s();return g(o.menuKeydown.emit(n))})("focus",function(n){_(e);let o=s();return g(o.menuFocus.emit(n))})("blur",function(n){_(e);let o=s();return g(o.menuBlur.emit(n))}),u(2,on,2,2,"ng-template",5),p()}if(i&2){let e=s();r("ngClass",Pt(10,Mi,!e.root,e.root))("@overlayAnimation",e.visible)("tabindex",e.tabindex),h("id",e.menuId+"_list")("aria-label",e.ariaLabel)("aria-labelledBy",e.ariaLabelledBy)("aria-activedescendant",e.focusedItemId)("aria-orientation","vertical")("data-pc-section","menu"),c(2),r("ngForOf",e.items)}}var rn=["rootmenu"],an=["container"],ln=()=>({"p-contextmenu p-component":!0,"p-contextmenu-overlay":!0}),cn=()=>({value:"visible"});function mn(i,l){if(i&1){let e=M();m(0,"div",3,0),b("@overlayAnimation.start",function(n){_(e);let o=s();return g(o.onOverlayAnimationStart(n))})("@overlayAnimation.done",function(n){_(e);let o=s();return g(o.onOverlayAnimationEnd(n))}),m(2,"p-contextMenuSub",4,1),b("itemClick",function(n){_(e);let o=s();return g(o.onItemClick(n))})("menuFocus",function(n){_(e);let o=s();return g(o.onMenuFocus(n))})("menuBlur",function(n){_(e);let o=s();return g(o.onMenuBlur(n))})("menuKeydown",function(n){_(e);let o=s();return g(o.onKeyDown(n))})("itemMouseEnter",function(n){_(e);let o=s();return g(o.onItemMouseEnter(n))}),p()()}if(i&2){let e=s();F(e.styleClass),r("ngClass",ge(20,ln))("ngStyle",e.style)("@overlayAnimation",ge(21,cn)),h("data-pc-section","root")("data-pc-name","contextmenu")("id",e.id),c(2),r("root",!0)("items",e.processedItems)("itemTemplate",e.itemTemplate)("menuId",e.id)("tabindex",e.disabled?-1:e.tabindex)("ariaLabel",e.ariaLabel)("ariaLabelledBy",e.ariaLabelledBy)("baseZIndex",e.baseZIndex)("autoZIndex",e.autoZIndex)("visible",e.submenuVisible())("focusedItemId",e.focused?e.focusedItemId:void 0)("activeItemPath",e.activeItemPath())}}var pn=(()=>{class i{document;el;renderer;cd;contextMenu;ref;visible=!1;items;itemTemplate;root=!1;autoZIndex=!0;baseZIndex=0;popup;menuId;ariaLabel;ariaLabelledBy;level=0;focusedItemId;activeItemPath;tabindex=0;itemClick=new A;itemMouseEnter=new A;menuFocus=new A;menuBlur=new A;menuKeydown=new A;sublistViewChild;constructor(e,t,n,o,a,d){this.document=e,this.el=t,this.renderer=n,this.cd=o,this.contextMenu=a,this.ref=d}getItemProp(e,t,n=null){return e&&e.item?w.getItemValue(e.item[t],n):void 0}getItemId(e){return e.item&&e.item?.id?e.item.id:`${this.menuId}_${e.key}`}getItemKey(e){return this.getItemId(e)}getItemClass(e){return O(D({},this.getItemProp(e,"class")),{"p-menuitem":!0,"p-highlight":this.isItemActive(e),"p-menuitem-active":this.isItemActive(e),"p-focus":this.isItemFocused(e),"p-disabled":this.isItemDisabled(e)})}getItemLabel(e){return this.getItemProp(e,"label")}getSeparatorItemClass(e){return O(D({},this.getItemProp(e,"class")),{"p-menuitem-separator":!0})}getAriaSetSize(){return this.items.filter(e=>this.isItemVisible(e)&&!this.getItemProp(e,"separator")).length}getAriaPosInset(e){return e-this.items.slice(0,e).filter(t=>this.isItemVisible(t)&&this.getItemProp(t,"separator")).length+1}isItemVisible(e){return this.getItemProp(e,"visible")!==!1}isItemActive(e){if(this.activeItemPath)return this.activeItemPath.some(t=>t.key===e.key)}isItemDisabled(e){return this.getItemProp(e,"disabled")}isItemFocused(e){return this.focusedItemId===this.getItemId(e)}isItemGroup(e){return w.isNotEmpty(e.items)}onItemMouseEnter(e){let{event:t,processedItem:n}=e;this.itemMouseEnter.emit({originalEvent:t,processedItem:n})}onItemClick(e,t){this.getItemProp(t,"command",{originalEvent:e,item:t.item}),this.itemClick.emit({originalEvent:e,processedItem:t,isFocus:!0})}onEnter(e,t){if(e.fromState==="void"&&e.toState){let n=e.element;this.position(n)}}position(e){let t=e.parentElement.parentElement,n=x.getOffset(e.parentElement.parentElement),o=x.getViewport(),a=e.offsetParent?e.offsetWidth:x.getHiddenElementOuterWidth(e),d=x.getOuterWidth(t.children[0]);e.style.top="0px",parseInt(n.left,10)+d+a>o.width-x.calculateScrollbarWidth()?e.style.left=-1*a+"px":e.style.left=d+"px"}static \u0275fac=function(t){return new(t||i)(v(et),v(Ee),v(We),v(W),v(xt(()=>mt)),v(St))};static \u0275cmp=S({type:i,selectors:[["p-contextMenuSub"]],viewQuery:function(t,n){if(t&1&&G(Si,5),t&2){let o;L(o=k())&&(n.sublistViewChild=o.first)}},hostAttrs:[1,"p-element"],inputs:{visible:[2,"visible","visible",H],items:"items",itemTemplate:"itemTemplate",root:[2,"root","root",H],autoZIndex:[2,"autoZIndex","autoZIndex",H],baseZIndex:[2,"baseZIndex","baseZIndex",te],popup:[2,"popup","popup",H],menuId:"menuId",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy",level:[2,"level","level",te],focusedItemId:"focusedItemId",activeItemPath:"activeItemPath",tabindex:[2,"tabindex","tabindex",te]},outputs:{itemClick:"itemClick",itemMouseEnter:"itemMouseEnter",menuFocus:"menuFocus",menuBlur:"menuBlur",menuKeydown:"menuKeydown"},features:[le],decls:1,vars:1,consts:[["sublist",""],["listItem",""],["htmlLabel",""],["role","menu",3,"ngClass","tabindex","keydown","focus","blur",4,"ngIf"],["role","menu",3,"keydown","focus","blur","ngClass","tabindex"],["ngFor","",3,"ngForOf"],["role","separator",3,"ngStyle","ngClass",4,"ngIf"],["role","menuitem","pTooltip","",3,"ngStyle","ngClass","class","tooltipOptions",4,"ngIf"],["role","separator",3,"ngStyle","ngClass"],["role","menuitem","pTooltip","",3,"ngStyle","ngClass","tooltipOptions"],[1,"p-menuitem-content",3,"click","mouseenter"],[4,"ngIf"],[3,"items","itemTemplate","menuId","visible","activeItemPath","focusedItemId","level","itemClick","itemMouseEnter",4,"ngIf"],["pRipple","",3,"target","ngClass",4,"ngIf"],["pRipple","",3,"routerLink","queryParams","routerLinkActive","routerLinkActiveOptions","target","ngClass","fragment","queryParamsHandling","preserveFragment","skipLocationChange","replaceUrl","state",4,"ngIf"],["pRipple","",3,"target","ngClass"],["class","p-menuitem-icon",3,"ngClass","ngStyle",4,"ngIf"],["class","p-menuitem-text",4,"ngIf","ngIfElse"],["class","p-menuitem-badge",3,"ngClass",4,"ngIf"],[1,"p-menuitem-icon",3,"ngClass","ngStyle"],[1,"p-menuitem-text"],[1,"p-menuitem-text",3,"innerHTML"],[1,"p-menuitem-badge",3,"ngClass"],[3,"styleClass",4,"ngIf"],[4,"ngTemplateOutlet"],[3,"styleClass"],[3,"data-pc-section"],["pRipple","",3,"routerLink","queryParams","routerLinkActive","routerLinkActiveOptions","target","ngClass","fragment","queryParamsHandling","preserveFragment","skipLocationChange","replaceUrl","state"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"itemClick","itemMouseEnter","items","itemTemplate","menuId","visible","activeItemPath","focusedItemId","level"]],template:function(t,n){t&1&&u(0,sn,3,13,"ul",3),t&2&&r("ngIf",n.root?!0:n.visible)},dependencies:()=>[Ce,Rt,xe,ke,ve,Ot,Nt,Bt,Ae,ct,i],encapsulation:2,data:{animation:[tt("overlayAnimation",[Te(":enter",[ye({opacity:0})]),Te(":leave",[ye({opacity:0})])])]}})}return i})(),mt=(()=>{class i{document;platformId;el;renderer;cd;config;overlayService;set model(e){this._model=e,this._processedItems=this.createProcessedItems(this._model||[])}get model(){return this._model}triggerEvent="contextmenu";target;global;style;styleClass;appendTo;autoZIndex=!0;baseZIndex=0;id;ariaLabel;ariaLabelledBy;pressDelay=500;onShow=new A;onHide=new A;templates;rootmenu;containerViewChild;submenuIconTemplate;itemTemplate;container;outsideClickListener;resizeListener;triggerEventListener;documentClickListener;documentTriggerListener;touchEndListener;pageX;pageY;visible=T(!1);relativeAlign;window;focused=!1;activeItemPath=T([]);focusedItemInfo=T({index:-1,level:0,parentKey:"",item:null});submenuVisible=T(!1);searchValue="";searchTimeout;_processedItems;_model;pressTimer;get visibleItems(){let e=this.activeItemPath().find(t=>t.key===this.focusedItemInfo().parentKey);return e?e.items:this.processedItems}get processedItems(){return(!this._processedItems||!this._processedItems.length)&&(this._processedItems=this.createProcessedItems(this.model||[])),this._processedItems}get focusedItemId(){let e=this.focusedItemInfo();return e.item&&e.item?.id?e.item.id:e.index!==-1?`${this.id}${w.isNotEmpty(e.parentKey)?"_"+e.parentKey:""}_${e.index}`:null}constructor(e,t,n,o,a,d,I){this.document=e,this.platformId=t,this.el=n,this.renderer=o,this.cd=a,this.config=d,this.overlayService=I,this.window=this.document.defaultView,Ft(()=>{let P=this.activeItemPath();w.isNotEmpty(P)?this.bindGlobalListeners():this.visible()||this.unbindGlobalListeners()})}ngOnInit(){this.id=this.id||Kt(),this.bindTriggerEventListener()}isMobile(){return x.isIOS()||x.isAndroid()}bindTriggerEventListener(){Ve(this.platformId)&&(this.triggerEventListener||(this.isMobile()?this.global?(this.triggerEventListener=this.renderer.listen(this.document,"touchstart",this.onTouchStart.bind(this)),this.touchEndListener=this.renderer.listen(this.document,"touchend",this.onTouchEnd.bind(this))):this.target&&(this.triggerEventListener=this.renderer.listen(this.target,"touchstart",this.onTouchStart.bind(this)),this.touchEndListener=this.renderer.listen(this.target,"touchend",this.onTouchEnd.bind(this))):this.global?this.triggerEventListener=this.renderer.listen(this.document,this.triggerEvent,e=>{this.show(e)}):this.target&&(this.triggerEventListener=this.renderer.listen(this.target,this.triggerEvent,e=>{this.show(e)}))))}bindGlobalListeners(){if(Ve(this.platformId)){if(!this.documentClickListener){let e=this.el?this.el.nativeElement.ownerDocument:"document";this.documentClickListener=this.renderer.listen(e,"click",t=>{this.containerViewChild.nativeElement.offsetParent&&this.isOutsideClicked(t)&&!t.ctrlKey&&t.button!==2&&this.triggerEvent!=="click"&&this.hide()}),this.documentTriggerListener=this.renderer.listen(e,this.triggerEvent,t=>{this.containerViewChild.nativeElement.offsetParent&&this.isOutsideClicked(t)&&this.hide()})}this.resizeListener||(this.resizeListener=this.renderer.listen(this.document.defaultView,"resize",e=>{this.hide()}))}}ngAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"submenuicon":this.submenuIconTemplate=e.template;break;case"item":this.itemTemplate=e.template;break;default:this.itemTemplate=e.template;break}})}createProcessedItems(e,t=0,n={},o=""){let a=[];return e&&e.forEach((d,I)=>{let P=(o!==""?o+"_":"")+I,q={item:d,index:I,level:t,key:P,parent:n,parentKey:o};q.items=this.createProcessedItems(d.items,t+1,q,P),a.push(q)}),a}getItemProp(e,t){return e?w.getItemValue(e[t]):void 0}getProccessedItemLabel(e){return e?this.getItemLabel(e.item):void 0}getItemLabel(e){return this.getItemProp(e,"label")}isProcessedItemGroup(e){return e&&w.isNotEmpty(e.items)}isSelected(e){return this.activeItemPath().some(t=>t.key===e.key)}isValidSelectedItem(e){return this.isValidItem(e)&&this.isSelected(e)}isValidItem(e){return!!e&&!this.isItemDisabled(e.item)&&!this.isItemSeparator(e.item)}isItemDisabled(e){return this.getItemProp(e,"disabled")}isItemSeparator(e){return this.getItemProp(e,"separator")}isItemMatched(e){return this.isValidItem(e)&&this.getProccessedItemLabel(e).toLocaleLowerCase().startsWith(this.searchValue.toLocaleLowerCase())}isProccessedItemGroup(e){return e&&w.isNotEmpty(e.items)}onItemClick(e){let{processedItem:t}=e,n=this.isProcessedItemGroup(t);if(this.isSelected(t)){let{index:a,key:d,level:I,parentKey:P,item:q}=t;this.activeItemPath.set(this.activeItemPath().filter(re=>d!==re.key&&d.startsWith(re.key))),this.focusedItemInfo.set({index:a,level:I,parentKey:P,item:q}),x.focus(this.rootmenu.sublistViewChild.nativeElement)}else n?this.onItemChange(e):this.hide()}onItemMouseEnter(e){this.onItemChange(e)}onKeyDown(e){let t=e.metaKey||e.ctrlKey;switch(e.code){case"ArrowDown":this.onArrowDownKey(e);break;case"ArrowUp":this.onArrowUpKey(e);break;case"ArrowLeft":this.onArrowLeftKey(e);break;case"ArrowRight":this.onArrowRightKey(e);break;case"Home":this.onHomeKey(e);break;case"End":this.onEndKey(e);break;case"Space":this.onSpaceKey(e);break;case"Enter":this.onEnterKey(e);break;case"Escape":this.onEscapeKey(e);break;case"Tab":this.onTabKey(e);break;case"PageDown":case"PageUp":case"Backspace":case"ShiftLeft":case"ShiftRight":break;default:!t&&w.isPrintableCharacter(e.key)&&this.searchItems(e,e.key);break}}onArrowDownKey(e){let t=this.focusedItemInfo().index!==-1?this.findNextItemIndex(this.focusedItemInfo().index):this.findFirstFocusedItemIndex();this.changeFocusedItemIndex(e,t),e.preventDefault()}onArrowRightKey(e){let t=this.visibleItems[this.focusedItemInfo().index];this.isProccessedItemGroup(t)&&(this.onItemChange({originalEvent:e,processedItem:t}),this.focusedItemInfo.set({index:-1,parentKey:t.key,item:t.item}),this.searchValue="",this.onArrowDownKey(e)),e.preventDefault()}onArrowUpKey(e){if(e.altKey){if(this.focusedItemInfo().index!==-1){let t=this.visibleItems[this.focusedItemInfo().index];!this.isProccessedItemGroup(t)&&this.onItemChange({originalEvent:e,processedItem:t})}this.hide(),e.preventDefault()}else{let t=this.focusedItemInfo().index!==-1?this.findPrevItemIndex(this.focusedItemInfo().index):this.findLastFocusedItemIndex();this.changeFocusedItemIndex(e,t),e.preventDefault()}}onArrowLeftKey(e){let t=this.visibleItems[this.focusedItemInfo().index],n=this.activeItemPath().find(d=>d.key===t.parentKey);w.isEmpty(t.parent)||(this.focusedItemInfo.set({index:-1,parentKey:n?n.parentKey:"",item:t.item}),this.searchValue="",this.onArrowDownKey(e));let a=this.activeItemPath().filter(d=>d.parentKey!==this.focusedItemInfo().parentKey);this.activeItemPath.set(a),e.preventDefault()}onHomeKey(e){this.changeFocusedItemIndex(e,this.findFirstItemIndex()),e.preventDefault()}onEndKey(e){this.changeFocusedItemIndex(e,this.findLastItemIndex()),e.preventDefault()}onSpaceKey(e){this.onEnterKey(e)}onEscapeKey(e){this.hide();let t=this.findVisibleItem(this.findFirstFocusedItemIndex()),n=this.focusedItemInfo();this.focusedItemInfo.set(O(D({},n),{index:this.findFirstFocusedItemIndex(),item:t.item})),e.preventDefault()}onTabKey(e){if(this.focusedItemInfo().index!==-1){let t=this.visibleItems[this.focusedItemInfo().index];!this.isProccessedItemGroup(t)&&this.onItemChange({originalEvent:e,processedItem:t})}this.hide()}onEnterKey(e){if(this.focusedItemInfo().index!==-1){let t=x.findSingle(this.rootmenu.el.nativeElement,`li[id="${`${this.focusedItemId}`}"]`),n=t&&x.findSingle(t,'a[data-pc-section="action"]');n?n.click():t&&t.click();let o=this.visibleItems[this.focusedItemInfo().index];if(!this.isProccessedItemGroup(o)){let d=this.focusedItemInfo();this.focusedItemInfo.set(O(D({},d),{index:this.findFirstFocusedItemIndex()}))}}e.preventDefault()}onItemChange(e){let{processedItem:t,isFocus:n}=e;if(w.isEmpty(t))return;let{index:o,key:a,level:d,parentKey:I,items:P}=t,q=w.isNotEmpty(P),re=this.activeItemPath().filter(ut=>ut.parentKey!==I&&ut.parentKey!==a);q&&(re.push(t),this.submenuVisible.set(!0)),this.focusedItemInfo.set({index:o,level:d,parentKey:I,item:t.item}),this.activeItemPath.set(re),n&&x.focus(this.rootmenu.sublistViewChild.nativeElement)}onMenuFocus(e){this.focused=!0;let t=this.focusedItemInfo().index!==-1?this.focusedItemInfo():{index:-1,level:0,parentKey:"",item:null};this.focusedItemInfo.set(t)}onMenuBlur(e){this.focused=!1,this.focusedItemInfo.set({index:-1,level:0,parentKey:"",item:null}),this.searchValue=""}onOverlayAnimationStart(e){switch(e.toState){case"visible":this.container=e.element,this.position(),this.moveOnTop(),this.appendOverlay(),this.bindGlobalListeners(),x.focus(this.rootmenu.sublistViewChild.nativeElement);break}}onOverlayAnimationEnd(e){switch(e.toState){case"void":this.onOverlayHide();break}}appendOverlay(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.containerViewChild.nativeElement):x.appendChild(this.containerViewChild.nativeElement,this.appendTo))}moveOnTop(){this.autoZIndex&&this.containerViewChild&&nt.set("menu",this.containerViewChild.nativeElement,this.baseZIndex+this.config.zIndex.menu)}onOverlayHide(){this.unbindGlobalListeners(),this.cd.destroyed||(this.target=null),this.container&&this.autoZIndex&&nt.clear(this.container),this.container=null}onTouchStart(e){this.pressTimer=setTimeout(()=>{this.show(e)},this.pressDelay)}onTouchEnd(){clearTimeout(this.pressTimer)}hide(){this.visible.set(!1),this.onHide.emit(),this.activeItemPath.set([]),this.focusedItemInfo.set({index:-1,level:0,parentKey:"",item:null})}toggle(e){this.visible()?this.hide():this.show(e)}show(e){this.activeItemPath.set([]),this.focusedItemInfo.set({index:-1,level:0,parentKey:"",item:null}),this.pageX=e.pageX,this.pageY=e.pageY,this.onShow.emit(),this.visible()?this.position():this.visible.set(!0),e.stopPropagation(),e.preventDefault()}position(){let e=this.pageX+1,t=this.pageY+1,n=this.containerViewChild.nativeElement.offsetParent?this.containerViewChild.nativeElement.offsetWidth:x.getHiddenElementOuterWidth(this.containerViewChild.nativeElement),o=this.containerViewChild.nativeElement.offsetParent?this.containerViewChild.nativeElement.offsetHeight:x.getHiddenElementOuterHeight(this.containerViewChild.nativeElement),a=x.getViewport();e+n-this.document.scrollingElement.scrollLeft>a.width&&(e-=n),t+o-this.document.scrollingElement.scrollTop>a.height&&(t-=o),e<this.document.scrollingElement.scrollLeft&&(e=this.document.scrollingElement.scrollLeft),t<this.document.scrollingElement.scrollTop&&(t=this.document.scrollingElement.scrollTop),this.containerViewChild.nativeElement.style.left=e+"px",this.containerViewChild.nativeElement.style.top=t+"px"}searchItems(e,t){this.searchValue=(this.searchValue||"")+t;let n=-1,o=!1;return this.focusedItemInfo().index!==-1?(n=this.visibleItems.slice(this.focusedItemInfo().index).findIndex(a=>this.isItemMatched(a)),n=n===-1?this.visibleItems.slice(0,this.focusedItemInfo().index).findIndex(a=>this.isItemMatched(a)):n+this.focusedItemInfo().index):n=this.visibleItems.findIndex(a=>this.isItemMatched(a)),n!==-1&&(o=!0),n===-1&&this.focusedItemInfo().index===-1&&(n=this.findFirstFocusedItemIndex()),n!==-1&&this.changeFocusedItemIndex(e,n),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.searchValue="",this.searchTimeout=null},500),o}findVisibleItem(e){return w.isNotEmpty(this.visibleItems)?this.visibleItems[e]:null}findLastFocusedItemIndex(){let e=this.findSelectedItemIndex();return e<0?this.findLastItemIndex():e}findLastItemIndex(){return w.findLastIndex(this.visibleItems,e=>this.isValidItem(e))}findPrevItemIndex(e){let t=e>0?w.findLastIndex(this.visibleItems.slice(0,e),n=>this.isValidItem(n)):-1;return t>-1?t:e}findNextItemIndex(e){let t=e<this.visibleItems.length-1?this.visibleItems.slice(e+1).findIndex(n=>this.isValidItem(n)):-1;return t>-1?t+e+1:e}findFirstFocusedItemIndex(){let e=this.findSelectedItemIndex();return e<0?this.findFirstItemIndex():e}findFirstItemIndex(){return this.visibleItems.findIndex(e=>this.isValidItem(e))}findSelectedItemIndex(){return this.visibleItems.findIndex(e=>this.isValidSelectedItem(e))}changeFocusedItemIndex(e,t){let n=this.findVisibleItem(t),o=this.focusedItemInfo();o.index!==t&&(this.focusedItemInfo.set(O(D({},o),{index:t,item:n.item})),this.scrollInView())}scrollInView(e=-1){let t=e!==-1?`${this.id}_${e}`:this.focusedItemId,n=x.findSingle(this.rootmenu.el.nativeElement,`li[id="${t}"]`);n&&n.scrollIntoView&&n.scrollIntoView({block:"nearest",inline:"nearest"})}bindResizeListener(){Ve(this.platformId)&&(this.resizeListener||(this.resizeListener=this.renderer.listen(this.document.defaultView,"resize",e=>{this.hide()})))}isOutsideClicked(e){return!(this.containerViewChild.nativeElement.isSameNode(e.target)||this.containerViewChild.nativeElement.contains(e.target))}unbindResizeListener(){this.resizeListener&&(this.resizeListener(),this.resizeListener=null)}unbindGlobalListeners(){this.documentClickListener&&(this.documentClickListener(),this.documentClickListener=null),this.documentTriggerListener&&(this.documentTriggerListener(),this.documentTriggerListener=null),this.resizeListener&&(this.resizeListener(),this.resizeListener=null),this.touchEndListener&&(this.touchEndListener(),this.touchEndListener=null)}unbindTriggerEventListener(){this.triggerEventListener&&(this.triggerEventListener(),this.triggerEventListener=null)}removeAppendedElements(){this.appendTo&&this.containerViewChild&&(this.appendTo==="body"?this.renderer.removeChild(this.document.body,this.containerViewChild.nativeElement):x.removeChild(this.containerViewChild.nativeElement,this.appendTo))}ngOnDestroy(){this.unbindGlobalListeners(),this.unbindTriggerEventListener(),this.removeAppendedElements()}static \u0275fac=function(t){return new(t||i)(v(et),v(wt),v(Ee),v(We),v(W),v(Pe),v($t))};static \u0275cmp=S({type:i,selectors:[["p-contextMenu"]],contentQueries:function(t,n,o){if(t&1&&_e(o,we,4),t&2){let a;L(a=k())&&(n.templates=a)}},viewQuery:function(t,n){if(t&1&&(G(rn,5),G(an,5)),t&2){let o;L(o=k())&&(n.rootmenu=o.first),L(o=k())&&(n.containerViewChild=o.first)}},hostAttrs:[1,"p-element"],inputs:{model:"model",triggerEvent:"triggerEvent",target:"target",global:[2,"global","global",H],style:"style",styleClass:"styleClass",appendTo:"appendTo",autoZIndex:[2,"autoZIndex","autoZIndex",H],baseZIndex:[2,"baseZIndex","baseZIndex",te],id:"id",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy",pressDelay:[2,"pressDelay","pressDelay",te]},outputs:{onShow:"onShow",onHide:"onHide"},features:[le],decls:1,vars:1,consts:[["container",""],["rootmenu",""],[3,"ngClass","class","ngStyle",4,"ngIf"],[3,"ngClass","ngStyle"],[3,"itemClick","menuFocus","menuBlur","menuKeydown","itemMouseEnter","root","items","itemTemplate","menuId","tabindex","ariaLabel","ariaLabelledBy","baseZIndex","autoZIndex","visible","focusedItemId","activeItemPath"]],template:function(t,n){t&1&&u(0,mn,4,22,"div",2),t&2&&r("ngIf",n.visible())},dependencies:[Ce,xe,ve,pn],styles:[`@layer primeng{.p-contextmenu{position:absolute}.p-contextmenu ul{margin:0;padding:0;list-style:none}.p-contextmenu .p-submenu-list{position:absolute;min-width:100%;z-index:1}.p-contextmenu .p-menuitem-link{cursor:pointer;display:flex;align-items:center;text-decoration:none;overflow:hidden;position:relative}.p-contextmenu .p-menuitem-text{line-height:1}.p-contextmenu .p-menuitem{position:relative}.p-contextmenu .p-menuitem-link .p-submenu-icon:not(svg){margin-left:auto}.p-contextmenu .p-menuitem-link .p-icon-wrapper{margin-left:auto}}
`],encapsulation:2,data:{animation:[tt("overlayAnimation",[Te(":enter",[ye({opacity:0}),it("250ms")]),Te(":leave",[it(".1s linear",ye({opacity:0}))])])]},changeDetection:0})}return i})(),Yt=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=Y({type:i});static \u0275inj=X({imports:[V,be,Gt,Se,ct,z,be,Se,z]})}return i})();var un=["wrapperMessageContent"],_n=["messageListRef"],gn=["chatControlRef"];function hn(i,l){if(i&1&&(m(0,"section",20)(1,"div",22,3),C(3),p(),f(4,"p-contextMenu",23),m(5,"p",24),C(6),he(7,"timeAgo"),p()()),i&2){let e=N(2),t=s().$implicit,n=s();c(3),$(" ",t.content," "),c(),r("target",e)("model",n.contextMenuItems),c(2),$(" ",fe(7,4,t.timeSend)," ")}}function fn(i,l){if(i&1&&(m(0,"section",21)(1,"div",22,4),C(3),p(),f(4,"p-contextMenu",23),m(5,"p",24),C(6),he(7,"timeAgo"),p()()),i&2){let e=N(2),t=s().$implicit,n=s();c(3),$(" ",t.content," "),c(),r("target",e)("model",n.contextMenuItems),c(2),$(" ",fe(7,4,t.timeSend)," ")}}function In(i,l){if(i&1&&u(0,hn,8,6,"section",20)(1,fn,8,6,"section",21),i&2){let e=l.$implicit;me(e.isSender?0:1)}}var Jt=(()=>{class i{messages=ee([]);sender=ee();sendMessage=J();wrapperMessageContent;messageListRef;chatControlRef;originalMessageContentHeight=T(0);originalMessageActionHeight=T(60);contextMenuItems=[{label:"Copy",icon:"pi pi-copy"},{label:"Edit message",icon:"pi pi-file-edit"}];chatControl=new Qe("");cd=y(W);computedMessageContentHeight=At(()=>(console.log("Re computedMessageContentHeight"),`${this.originalMessageContentHeight()-this.originalMessageActionHeight()}px`));screenSize$=Ue(window,"resize").pipe(_t(()=>({width:window.innerWidth,height:window.innerHeight})),ae(50),Ct({width:window.innerWidth,height:window.innerHeight}));ngAfterViewInit(){this.registerValueChanges(),this.originalMessageContentHeight.set(this.wrapperMessageContent.nativeElement.offsetHeight),this.scrollToBottom()}registerValueChanges(){this.chatControl.valueChanges.pipe(E(e=>{console.log("chatControl: ",e)})).subscribe(),Ue(this.chatControlRef.nativeElement,"keyup").pipe(ae(10),ht(e=>e.keyCode===13),Me(),E(e=>{this.sendMessage.emit(e?.target?.value),this.chatControlRef.nativeElement.value=""})).subscribe(),this.screenSize$.pipe(E(()=>{this.originalMessageContentHeight.set(this.wrapperMessageContent.nativeElement.offsetHeight),this.cd.detectChanges(),this.scrollToBottom()})).subscribe()}scrollToBottom(){this.messageListRef&&gt(100).pipe(ft(1)).subscribe(()=>{this.messageListRef.nativeElement.scrollTo({top:this.messageListRef.nativeElement.scrollHeight,behavior:"smooth"})})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["lib-chatting"]],viewQuery:function(t,n){if(t&1&&(G(un,7),G(_n,7),G(gn,7)),t&2){let o;L(o=k())&&(n.wrapperMessageContent=o.first),L(o=k())&&(n.messageListRef=o.first),L(o=k())&&(n.chatControlRef=o.first)}},inputs:{messages:[1,"messages"],sender:[1,"sender"]},outputs:{sendMessage:"sendMessage"},standalone:!0,features:[Q],decls:21,vars:7,consts:[["wrapperMessageContent",""],["messageListRef",""],["chatControlRef",""],["msgRef",""],["messageRef",""],[1,"w-full","h-full"],[1,"pt-3","pb-1","border-bottom-1","border-blue-900","w-full","column-gap-3","flex","min-h-max","px-4","flex","align-items-center"],[1,"w-full","column-gap-3","flex"],["size","large","shape","circle",3,"image"],[1,"w-full","flex","flex-column"],[1,"mb-1"],[1,"text-xs","text-color"],[1,"ml-auto","h-full","flex","align-items-center"],["tooltipPosition","right",1,"pi","pi-info-circle","text-2xl","text-color","cursor-pointer",3,"pTooltip"],[1,"w-full","relative",2,"height","calc(100% - 73px)"],[1,"overflow-y-auto","mt-2","px-2"],[1,"fixed","bottom-0"],["iconPosition","right",1,"w-full"],["styleClass","pi pi-send","tooltipPosition","right"],["type","text","pInputText","","placeholder","Typing message...",1,"py-2","transition-duration-300","h-3rem","text-base","text-color","surface-ground","p-2","border-1","border-solid","surface-border","border-round","appearance-none","outline-none","focus:border-primary","w-full"],[1,"ml-auto","mb-4","col-6","column-gap-2","min-h-max","bg-blue-700","py-2","px-2","border-round-bottom-2xl","border-round-left-2xl","cursor-pointer","transition-duration-200"],[1,"mr-auto","mb-4","col-6","column-gap-2","min-h-max","bg-gray-800","py-2","px-2","border-round-bottom-2xl","border-round-right-2xl","cursor-pointer","transition-duration-200"],[1,"text-sm"],[3,"target","model"],[1,"text-xs","p-0","mx-0","mb-0","mt-2","font-italic"]],template:function(t,n){if(t&1&&(m(0,"section",5)(1,"section",6)(2,"section",7),f(3,"p-avatar",8),m(4,"section",9)(5,"span",10),C(6),p(),f(7,"div",11),p()(),m(8,"section",12),f(9,"i",13),p()(),m(10,"section",14,0)(12,"section",15,1),de(14,In,2,1,null,null,pe),p(),m(16,"section",16)(17,"p-iconField",17),f(18,"p-inputIcon",18)(19,"input",19,2),p()()()()),t&2){let o,a,d=N(11);c(3),r("image",(o=n.sender())==null||o.receiver==null?null:o.receiver.avatarUrl),c(3),R((a=n.sender())==null||a.receiver==null?null:a.receiver.fullName),c(3),r("pTooltip","View infor"),c(3),ce("height",n.computedMessageContentHeight()),c(2),ue(n.messages()),c(2),ce("width",d.offsetWidth+"px")}},dependencies:[se,Ze,V,ie,Fe,Se,Ae,je,He,Ge,Be,Yt,mt,oe]})}return i})();var pt={messages:[],members:[],conversationId:-1,conversation:{id:-1,receiver:null},status:st.Idle};var dt=Re(Ne(pt),Oe((i,l=y(ne),e=$e())=>({reset(){K(i,pt)},setConversation(t,n,o){K(i,{conversationId:t,messages:n||[],conversation:{id:t,receiver:o}})},sendMessage(t){let{conversationId:n,conversation:o}=Z(i);console.log("Send to: ",o.receiver),e.sendMessage(n,t,l.user().profile?.id,[o.receiver?.id])},subscribeMessage(){e.listen(Ke.NEW_MESSAGE).pipe(E(t=>{Z(i).messages?.length?K(i,{messages:[...Z(i).messages,ei(t,l.user()?.profile?.id)]}):K(i,{messages:[ei(t,l.user()?.profile?.id)]})})).subscribe()}})),De({onDestroy(i){i.reset()},onInit(i){i.subscribeMessage()}}));function ei(i,l){return O(D({},i),{isSender:i.senderId==l,isReceiver:i.senderId==l,timeSend:new Date().toISOString()})}var Ss=(()=>{class i{appState=y(ne);chatStore=y(dt);conversationStore=y(lt);messages=this.chatStore.messages;conversations=this.conversationStore.conversations;conversation=T(null);messageCategories=T([{label:"All",selected:!0},{label:"Unread",selected:!1},{label:"Groups",selected:!1}]);onMessageCategoryChanges(e){console.log("onMessageCategoryChanges",e)}onConversationChanges(e){let{id:t}=this.appState.user()?.profile;this.chatStore.conversationId()&&(this.conversationStore.resotreMessageToConversation(this.chatStore.conversationId(),this.chatStore.messages()),this.conversationStore.leaveRoom(this.chatStore.conversationId(),t),this.chatStore.reset()),this.conversation.set(e),this.conversationStore.joinRoom(e.id,t),console.log("event.receiver: ",e.receiver),this.chatStore.setConversation(e.id,this.conversationStore.getConversationMessages(e.id),e.receiver)}onSendMessage(e){this.chatStore.sendMessage(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["lib-chat-feature"]],standalone:!0,features:[Vt([dt,lt]),Q],decls:3,vars:4,consts:[[1,"w-full","h-full","grid","overflow-hidden","p-0","m-0"],[1,"hidden","md:block","md:col-4","border-right-1","border-blue-900","h-full",3,"selecteMessageCategoryChanges","selectConversationChanges","messageCategoies","conversations"],[1,"col-12","md:col-8","p-0","h-full",3,"sendMessage","sender","messages"]],template:function(t,n){t&1&&(m(0,"section",0)(1,"lib-conversation",1),b("selecteMessageCategoryChanges",function(a){return n.onMessageCategoryChanges(a)})("selectConversationChanges",function(a){return n.onConversationChanges(a)}),p(),m(2,"lib-chatting",2),b("sendMessage",function(a){return n.onSendMessage(a)}),p()()),t&2&&(c(),r("messageCategoies",n.messageCategories())("conversations",n.conversations()),c(),r("sender",n.conversation())("messages",n.messages()))},dependencies:[ze,se,V,be,ie,Jt,oe,Xt]})}return i})();export{Ss as ChatFeatureComponent};
